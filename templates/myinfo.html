<!DOCTYPE html>
<html lang="zh-CN">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="A forum named Masege">
    <meta name="author" content="Masege">

    <title>Masege - 校友论坛</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/css/blog-home.css" rel="stylesheet">
    <link href="/static/css/image-upload.css" rel="stylesheet">

</head>

<body>

<!-- Navigation -->
<!-- 引入notifications的模板标签 -->
{% load notifications_tags %}
{% notifications_unread as unread_count %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/">Masege · 一个论坛</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/">主页</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/notice/" style="float: left">消息</a>
                    {% if unread_count %}
                        <svg viewBox="0 1 6 7"
                             width="6px"
                             height="6px" style="float: right;margin-left: -10px">
                            <circle cx="3"
                                    cy="4"
                                    r="3"
                                    fill="#ff6b6b"
                            ></circle>
                        </svg>
                    {% endif %}
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="#">我的
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/about/">关于</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/signout/">退出</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Page Content -->
<div class="container">
    <h1 class="my-4">关于我
        <small>
            <small>
                <small>个人信息</small>
            </small>
        </small>
    </h1>
    <form method="POST" id="info_form" name="info_form" enctype="multipart/form-data">

        <div class="row">
            <div class="col-md-7 ">
                {#            {% block loadinfo %}#}
                {% csrf_token %}
                <div class="form-group">
                    <label for="sname" class="col-sm-2 control-label">姓名</label>
                    <div class="col-sm-11">
                        <input type="text" class="form-control" name="name" id="name"
                               value="{{ myinfo.sname }}" disabled="true" required
                               oninvalid="setCustomValidity('还没有内容～')" oninput="setCustomValidity('')">
                    </div>
                </div>
                <div class="form-group">
                    <label for="sex" class="col-sm-2 control-label">性别</label>
                    <div class="col-sm-11">
                        {% if myinfo.ssex %}
                            <input type="radio" name="sex" id="sex1" value="1" checked disabled="true">男</input>
                            &nbsp&nbsp&nbsp&nbsp&nbsp
                            <input type="radio" name="sex" id="sex2" value="0" disabled="true">女</input>
                        {% else %}
                            <input type="radio" name="sex" id="sex1" value="1" disabled="true">男</input>
                            &nbsp&nbsp&nbsp&nbsp&nbsp
                            <input type="radio" name="sex" id="sex2" value="0" checked disabled="true">女</input>
                        {% endif %}

                    </div>
                </div>
                <div class="form-group">
                    <label for="institution" class="col-sm-2 control-label">学院</label>
                    <div class="col-sm-11">
                        <input type="text" class="form-control" name="institution" id="institution"
                               value="{{ myinfo.sinst }}" disabled="true" required
                               oninvalid="setCustomValidity('还没有内容～')" oninput="setCustomValidity('')"/>
                    </div>
                </div>
                <div class="form-group">
                    <label for="department" class="col-sm-2 control-label">专业</label>
                    <div class="col-sm-11">
                        <input type="text" class="form-control" name="department" id="department"
                               value="{{ myinfo.sdept }}" disabled="true"
                               required oninvalid="setCustomValidity('还没有内容～')" oninput="setCustomValidity('')"/>
                    </div>
                </div>
                <div class="form-group">
                    <label for="class" class="col-sm-2 control-label">班级</label>
                    <div class="col-sm-11">
                        <input type="text" class="form-control" name="class" id="class"
                               value="{{ myinfo.sclass }}" disabled="true" required
                               oninvalid="setCustomValidity('还没有内容～')" oninput="setCustomValidity('')"/>
                    </div>
                </div>
                <div class="form-group">
                    <label for="signature" class="col-sm-2 control-label">个性签名</label>
                    <div class="col-sm-11">
                        <input type="text" class="form-control" name="signature" id="signature"
                               value="{{ myinfo.signature }}" disabled="true">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="button" class="btn btn-info" onclick="fix()" style="margin-left: 0px">修改</button>
                        <input type="submit" name="savebtn" id="savebtn" class="btn btn-success" disabled="true"
                               value="提交" style="margin-left: 50px"/>
                    </div>
                </div>
            </div>
            {% load static %}
            <div class="col-md-2">
                <a class="thumbnail">
                    <img name="avatar" id="avatar" width="250" class="img-thumbnail" src="{{ myinfo.avatar }}"
                         style="margin-top: 20px">
                </a><br><br>
                <div align="center"><a href="javascript:;" class="file" style="visibility: hidden" id="chooseAvatar">选 择
                    <input align="center" type="file" accept="image/gif,image/jpeg,image/jpg,image/png"
                           onchange="newAvatar(event)" name="avatarFile" id="avatarFile">
                </a></div>
            </div>
    </form>

</div>
</div>
<!-- /.container -->

<script type="text/javascript">
    function fix() {
        document.getElementById("name").disabled = false;
        document.getElementById("sex1").disabled = false;
        document.getElementById("sex2").disabled = false;
        document.getElementById("institution").disabled = false;
        document.getElementById("department").disabled = false;
        document.getElementById("class").disabled = false;
        document.getElementById("signature").disabled = false;
        document.getElementById("savebtn").disabled = false;
        document.getElementById("chooseAvatar").style.visibility = "visible";
    }

    function newAvatar(e) {
        var files = e.target.files;
        if (files && files.length > 0) {
            // 获取目前上传的文件
            file = files[0];// 文件大小校验的动作
            if (file.size > 1024 * 1024 * 4) {
                alert('图片大小不能超过 4MB!');
                return false;
            }
            // 获取 window 的 URL 工具
            var URL = window.URL || window.webkitURL;
            // 通过 file 生成目标 url
            var imgURL = URL.createObjectURL(file);
            //用attr将img的src属性改成获得的url
            $("#avatar").attr("src", imgURL);
        }
    };

</script>

<!-- Footer -->
<footer class="py-5 bg-dark" style="margin-top:350px;">
    <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Masege 2019</p>
    </div>
    <!-- /.container -->
</footer>

<!-- Bootstrap core JavaScript -->
<script src="/static/vendor/jquery/jquery.min.js"></script>
<script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>
